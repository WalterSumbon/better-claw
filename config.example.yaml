# ============================================================================
# Better-Claw 配置文件
# ============================================================================
#
# 所有字段都有默认值，最小配置为空文件即可启动。
# 复制此文件到 <data-dir>/config.yaml 并根据需要修改。
#
# 配置优先级：CLI 参数 > 配置文件 > 默认值
# ============================================================================

# ----------------------------------------------------------------------------
# Anthropic API 配置
# ----------------------------------------------------------------------------
# agent-sdk 可复用 Claude CLI 的认证信息，通常不需要手动配置 apiKey。
# 仅在无法使用 CLI 认证或需要连接代理服务器时才需要配置。
anthropic:
  # API Key（可选）。
  # 如果已通过 `claude login` 登录 CLI，则无需配置。
  # apiKey: "sk-ant-your-api-key-here"

  # Auth Token（可选）。
  # 用于代理服务器认证，对应环境变量 ANTHROPIC_AUTH_TOKEN。
  # authToken: "your-auth-token-here"

  # Base URL（可选）。
  # 用于连接代理服务器或自定义 API 端点，对应环境变量 ANTHROPIC_BASE_URL。
  # baseUrl: "https://api.anthropic.com"

  # 默认模型 ID。
  # 可选值：claude-opus-4-6, claude-sonnet-4-6, claude-haiku-4-5-20251001 等。
  # 默认值："claude-opus-4-6"
  model: "claude-opus-4-6"

  # 单次查询最大预算（美元，可选）。
  # 超过此预算时查询会被终止。不设置则不限制。
  # maxBudgetUsd: 10.0

# ----------------------------------------------------------------------------
# Telegram 机器人配置（可选）
# ----------------------------------------------------------------------------
# 不配置此段则不启动 Telegram 适配器，仅提供 CLI 交互。
# telegram:
#   # Bot Token（必填）。从 Telegram @BotFather 获取。
#   botToken: "123456789:AABBccDDeeFFggHHiiJJkkLLmmNNooPPqqR"
#
#   # HTTP 代理地址（可选）。用于网络受限环境。
#   # proxy: "http://127.0.0.1:7890"

# ----------------------------------------------------------------------------
# 钉钉机器人配置（可选）
# ----------------------------------------------------------------------------
# 不配置此段则不启动钉钉适配器。
# 需要在钉钉开放平台创建企业内部应用，启用机器人能力并选择 Stream 模式。
# dingtalk:
#   # AppKey / ClientID（必填）。从钉钉开放平台应用凭证页获取。
#   clientId: "your-app-key"
#
#   # AppSecret / ClientSecret（必填）。从钉钉开放平台应用凭证页获取。
#   clientSecret: "your-app-secret"
#
#   # robotCode（可选）。用于主动发消息 API，不填时默认使用 clientId。
#   # robotCode: "your-robot-code"

# ----------------------------------------------------------------------------
# 日志配置
# ----------------------------------------------------------------------------
logging:
  # 日志级别。
  # 可选值：trace, debug, info, warn, error, fatal
  # 默认值："info"
  level: "info"

  # 日志文件目录。相对路径基于 dataDir 解析。
  # 默认值："logs"
  directory: "logs"

  # 单个日志文件最大体积（pino-roll 格式：数字 + 单位）。
  # 单位：k（KB）、m（MB）、g（GB）。
  # 默认值："10m"
  maxSize: "10m"

  # 保留的日志轮转文件数量。超过后自动删除最旧的文件。
  # 默认值：10
  maxFiles: 10

  # Bot 回复日志的最大显示长度（字符数）。超过则在日志中显示为摘要。
  # 默认值：200
  replyLogMaxLength: 200

# ----------------------------------------------------------------------------
# 消息推送粒度配置
# ----------------------------------------------------------------------------
# 控制 agent 处理过程中向用户推送哪些中间信息。
messagePush:
  # 是否推送 assistant 中间文本消息（agent 思考过程中的阶段性回复）。
  # 启用后用户可以看到 agent 的中间思考结果，降低等待焦虑。
  # 默认值：true
  pushIntermediateMessages: true


# ----------------------------------------------------------------------------
# 数据目录路径
# ----------------------------------------------------------------------------
# 存放用户数据、会话记录、日志等所有运行时数据的根目录。
# CLI --data-dir 参数优先级更高。
# 默认值："data"
dataDir: "data"

# ----------------------------------------------------------------------------
# Agent 权限模式
# ----------------------------------------------------------------------------
# 控制 agent 执行文件操作和 shell 命令时的权限策略。
# 可选值：
#   - "default"：每次操作需用户确认（最安全，适合不信任的环境）
#   - "acceptEdits"：自动允许文件编辑，shell 命令仍需确认
#   - "bypassPermissions"：跳过所有权限检查（最方便，适合私有部署）
# 默认值："bypassPermissions"
permissionMode: "bypassPermissions"

# ----------------------------------------------------------------------------
# 会话管理配置
# ----------------------------------------------------------------------------
# 控制对话会话的自动轮转策略和摘要生成行为。
# 当对话过长或间隔过久时，系统会自动归档当前会话并创建新会话，
# 同时生成摘要保留长期记忆。
session:
  # 时间间隔轮转阈值（小时）。
  # 用户最后一条消息距今超过此时间后，下次对话自动开启新会话。
  # 默认值：4
  rotationTimeoutHours: 4

  # Context 占比软轮转阈值（0-1）。
  # 当上下文 token 数占模型 context window 的比例达到此值时，
  # 在后台异步启动 summary 生成和会话浓缩，不阻塞当前消息处理。
  # 默认值：0.8
  rotationContextRatio: 0.8

  # Context 占比强制轮转阈值（0-1）。
  # 当上下文比例超过此值时，同步等待轮转完成后才处理下一条消息。
  # 必须大于 rotationContextRatio。
  # 默认值：0.9
  rotationForceRatio: 0.9

  # 轮转时是否生成 AI 摘要。
  # 启用后会在会话归档时自动生成对话摘要，用于后续会话的上下文衔接。
  # 默认值：true
  summaryEnabled: true

  # 摘要生成使用的模型。
  # 推荐使用较便宜的模型以降低成本，摘要任务不需要最强模型。
  # 默认值："claude-haiku-4-20250414"
  summaryModel: "claude-haiku-4-20250414"

  # system prompt 中展示的最近 session 数量（短期记忆）。
  # 更早的 session 会被浓缩合并到累积摘要中（长期记忆）。
  # 默认值：3
  maxRecentSessions: 3

# ----------------------------------------------------------------------------
# 重启权限配置
# ----------------------------------------------------------------------------
# 控制 agent 和用户分别是否可以触发服务重启。
restart:
  # 是否允许 agent（通过 MCP 工具）触发重启。
  # 设为 false 后 agent 将无法调用 restart 工具。
  # 默认值：true
  allowAgent: true

  # 是否允许用户（通过 /restart 命令）触发重启。
  # 设为 false 后所有用户的 /restart 命令都会被拒绝。
  # 默认值：true
  allowUser: true

  # 允许触发重启的用户 ID 白名单（仅在 allowUser 为 true 时生效）。
  # 为空数组时表示不限制，所有用户均可使用 /restart。
  # 填入用户 ID 后，仅白名单内的用户可以触发重启。
  # 默认值：[]（不限制）
  # userWhitelist:
  #   - "user_xxxxxxxx"

# ----------------------------------------------------------------------------
# 语音转文字配置（可选）
# ----------------------------------------------------------------------------
# 使用本地 OpenAI Whisper CLI 进行语音转录。
# 不配置此段时，语音消息仅保存音频文件，由 agent 自行决定如何处理
# （如通过外部 skill 或 MCP 工具转录）。
# 前置依赖：需安装 openai-whisper (pip install openai-whisper) 和 ffmpeg。
# speechToText:
#   # whisper 可执行文件路径。
#   # 如果已加入 PATH 则直接写 "whisper"，否则写完整路径。
#   # 默认值："whisper"
#   whisperPath: "whisper"
#
#   # whisper 模型名称。模型越大精度越高，但速度越慢、显存占用越大。
#   # 可选值：tiny, base, small, medium, large
#   # 默认值："base"
#   model: "base"
#
#   # 识别语言（可选）。不设置则自动检测语言。
#   # 常用值：zh（中文）, en（英文）, ja（日文）等。
#   # language: "zh"
